# buildPlatform.py 技术债分析

## 1. 文件概览
- **功能**: 负责台基（Platform/Taiming）和踏跺（Steps）的营造。
- **代码行数**: 约 1088 行。
- **依赖**: `utils`, `buildFloor`, `const`, `data`, `texture`。

## 2. 主要技术债

### 2.1 踏跺生成的复制粘贴
- **问题**: `__buildSteps` 和 `__drawStep` 中处理不同方向（东、西、南、北）的踏跺时，存在大量相似的 `if-else` 分支，逻辑高度重复。
- **影响**: 增加维护成本，容易引入复制粘贴错误。
- **建议**: 统一踏跺的坐标系处理，通过局部坐标系转换来消除方向特异性代码。

### 2.2 散水/土衬生成的布尔运算依赖
- **问题**: `__addPlatformExpand` 使用布尔运算（Boolean Modifier）来生成散水和土衬。
- **影响**: 布尔运算在 Blender 中性能开销大且不稳定（容易产生糟糕的拓扑结构）。
- **建议**: 尽可能使用程序化网格生成（Procedural Mesh Generation）来替代布尔运算，直接计算顶点的正确位置。

### 2.3 硬编码的尺寸比例
- **问题**: 踏跺的进深、高度比例被硬编码（如 `con.STEP_RATIO`），且部分计算直接使用了字面量。
- **影响**: 难以适应不同制式（如清式与宋式）的比例要求。
- **建议**: 将所有比例参数化，支持从配置文件或用户设置中读取。

### 2.4 缺乏模块化
- **问题**: 台基和踏跺的逻辑混杂在一起，虽然有函数分离，但数据流向依然纠缠。
- **影响**: 难以单独复用踏跺生成逻辑。
- **建议**: 将踏跺生成逻辑封装为独立的 `StepBuilder` 类。

## 3. 重构优先级
- **高**: 优化踏跺生成的方向处理逻辑，消除重复代码。
- **中**: 替换布尔运算为网格生成（针对散水/土衬）。
- **低**: 参数化尺寸比例。
