# 技术债分析报告: buildSplice.py

## 1. 文件概览
- **文件路径**: `buildSplice.py`
- **主要功能**: 处理建筑间的拼接（Splice），如勾连搭、抱厦、十字相交等。主要通过生成布尔（Boolean）对象来裁剪网格。
- **代码规模**: 约 2300+ 行（逻辑极其复杂）。

## 2. 主要技术债

### 2.1 破坏性工作流 (Destructive Workflow)
- **问题描述**: 大量使用 `Apply Modifier` 或直接修改 Mesh 数据（`bmesh` 操作）。一旦生成，难以参数化调整。虽然使用了 Boolean 修改器，但辅助的 Boolean 对象生成逻辑非常复杂且脆弱。
- **影响**: 用户体验差。移动主建筑后，拼接处的布尔对象可能不会自动更新，导致模型穿插或破面。

### 2.2 复杂的几何算法
- **问题描述**: 为了计算屋顶交点，代码中手动实现了复杂的几何相交算法（`mesh_mesh_intersection`）。
- **影响**: 维护成本高。Blender API 版本更新可能导致这些底层几何操作失效。

### 2.3 硬编码的裁剪逻辑
- **问题描述**: 针对不同类型的拼接（悬山抱厦、歇山抱厦、十字交叉），编写了大量独立的、高度重复的裁剪函数（如 `__unionParallelXuanshan`, `__unionParallelXieshan`）。
- **代码重复**: 裁剪柱网、裁剪台基、裁剪屋顶的代码在各个函数中大量复制粘贴。

### 2.4 性能隐患
- **问题描述**: 实时进行高精度的 Mesh 布尔运算非常消耗性能。在复杂场景下，拼接操作可能导致明显的卡顿。

## 3. 改进建议
1.  **通用裁剪策略**: 抽象出通用的“裁剪体生成器”，根据目标建筑的包围盒自动生成，而不是针对每种屋顶类型写死逻辑。
2.  **非破坏性优化**: 尽量保留 Modifier 栈，减少直接的 Mesh 编辑。
3.  **算法库**: 将几何相交算法提取到独立的数学库中，并增加单元测试。
