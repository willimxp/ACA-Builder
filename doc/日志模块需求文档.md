# ACA Builder 日志模块需求文档

## 1. 概述

### 1.1 目的
本文档描述 ACA Builder 插件日志模块的功能需求，为开发和维护提供依据。

### 1.2 背景
原日志功能直接嵌入在 `__init__.py` 中，存在以下问题：
- 日志级别固定为 DEBUG，无法配置
- 日志路径硬编码，不灵活
- 缺少日志轮转机制
- 代码耦合度高，不利于维护

### 1.3 范围
本文档适用于 ACA Builder 插件的日志模块 `aca_logging.py`。

---

## 2. 功能需求

### 2.1 日志级别配置
| 需求编号 | 需求描述 | 优先级 |
|---------|---------|--------|
| LOG-001 | 支持 DEBUG/INFO/WARNING/ERROR 四级日志 | 高 |
| LOG-002 | 默认日志级别为 INFO | 高 |
| LOG-003 | 支持运行时动态调整日志级别 | 中 |

### 2.2 日志输出
| 需求编号 | 需求描述 | 优先级 |
|---------|---------|--------|
| LOG-004 | 同时输出到控制台和文件 | 高 |
| LOG-005 | 日志格式：`时间 [级别] : 消息` | 高 |
| LOG-006 | 时间格式：`YY/MM/DD HH:MM:SS` | 高 |

### 2.3 日志文件管理
| 需求编号 | 需求描述 | 优先级 |
|---------|---------|--------|
| LOG-007 | 支持日志轮转功能 | 高 |
| LOG-008 | 单个日志文件最大 5MB | 高 |
| LOG-009 | 保留 3 个历史备份文件 | 高 |
| LOG-010 | 支持禁用日志轮转（兼容旧行为） | 中 |

### 2.4 路径配置
| 需求编号 | 需求描述 | 优先级 |
|---------|---------|--------|
| LOG-011 | 默认路径：`Blender用户目录/scripts/addons/ACA Builder/` | 高 |
| LOG-012 | 支持自定义日志文件路径 | 低 |

---

## 3. 接口定义

### 3.1 初始化日志
```python
def init_logger(
    log_level: int = None,          # 日志级别，默认 INFO
    log_path: pathlib.Path = None,  # 日志目录，默认用户目录
    log_filename: str = None,       # 日志文件名，默认 aca_log.txt
    use_rotating: bool = True,      # 是否启用轮转，默认 True
    max_bytes: int = 5242880,       # 单文件最大字节，默认 5MB
    backup_count: int = 3           # 备份数量，默认 3
) -> logging.Logger
```

### 3.2 获取日志记录器
```python
def get_logger() -> logging.Logger
```

### 3.3 更新日志级别
```python
def update_log_level(log_level: int) -> None
```

### 3.4 移除日志处理器
```python
def remove_logger() -> None
```

---

## 4. 用户界面

### 4.1 偏好设置选项
在 Blender 插件偏好设置中提供以下配置：

| 选项 | 类型 | 默认值 | 说明 |
|-----|------|-------|------|
| 日志级别 | 枚举 | INFO | DEBUG/INFO/WARNING/ERROR |
| 启用日志轮转 | 布尔 | True | 自动归档旧日志 |

---

## 5. 非功能需求

### 5.1 性能
- DEBUG 级别日志在生产环境不应显著影响性能

### 5.2 兼容性
- 兼容 Blender 4.2.0+
- 支持 Windows/macOS/Linux

### 5.3 编码
- 日志文件使用 UTF-8 编码

---

## 6. 版本历史

| 版本 | 日期 | 修改内容 | 作者 |
|-----|------|---------|------|
| 1.0 | 260210 | 初始版本，从 __init__.py 独立 | willimxp |
