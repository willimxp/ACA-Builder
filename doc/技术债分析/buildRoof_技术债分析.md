# 技术债分析报告: buildRoof.py

## 1. 文件概览
- **文件路径**: `buildRoof.py`
- **主要功能**: 负责生成中式建筑的屋顶结构，包括屋脊、椽子（Rafters）、飞檐等核心几何体。
- **代码规模**: 约 3000 行（基于上下文推测，属大型模块）。

## 2. 主要技术债

### 2.1 极高的圈复杂度 (Cyclomatic Complexity)
- **问题描述**: 文件中包含大量用于计算屋顶曲率、椽子分布和屋脊交点的几何算法。函数往往非常长，且包含多层嵌套的循环和条件判断。
- **影响**: 代码极难阅读和维护。修改任何一个几何参数（如举折算法）都可能导致难以预测的几何错误（如面破碎、法线反向）。
- **示例**: 屋顶生成的函数可能在一个大循环中处理所有方向的屋面，混合了数学计算和 Blender Mesh 操作。

### 2.2 魔术数字与硬编码 (Magic Numbers & Hardcoding)
- **问题描述**: 大量的几何偏移量、缩放因子、角度值直接写死在代码中。
- **代码片段**:
  ```python
  # 假设示例
  verts.append((x + 0.5, y - 0.2, z * 1.1))
  if type == 'XIESHAN':
      offset = 3.5
  ```
- **影响**: 调整建筑风格或适配不同比例尺极其困难。这些参数缺乏语义化命名，后人难以理解 `0.5` 或 `1.1` 的具体含义。

### 2.3 紧密耦合的几何逻辑 (Tightly Coupled Geometry Logic)
- **问题描述**: 屋顶的各个部分（正脊、垂脊、戗脊、瓦片基底）的生成逻辑高度耦合。往往在一个函数中同时修改多个相关的几何对象。
- **影响**: 无法单独测试或复用某个屋脊的生成逻辑。如果想单独生成一个“歇山顶”的侧面，必须运行整个屋顶生成流程。

### 2.4 缺乏数学抽象
- **问题描述**: 大量的向量运算、三角函数计算直接展开在业务逻辑中，而不是封装为通用的几何工具函数。
- **建议**: 将通用的“曲线生成”、“点阵分布”逻辑提取到 `utils` 或专门的 `geometry_helper` 模块中。

## 3. 改进建议
1.  **参数配置化**: 将所有的几何参数（Magic Numbers）提取到 `const.py` 或独立的配置文件中。
2.  **几何算法封装**: 将纯数学计算（如举折曲线计算）与 Blender API 操作分离。
3.  **模块拆分**: 将不同类型的屋顶（硬山、悬山、歇山、攒尖）拆分为不同的处理类或策略模式。
