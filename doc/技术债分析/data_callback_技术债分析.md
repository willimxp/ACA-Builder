# 技术债分析报告：data_callback.py

## 1. 文件概览
- **路径**: `/Volumes/XP.T9/Blender/ACA Builder/data_callback.py`
- **功能**: 处理属性更新的回调逻辑。
- **行数**: 约 570 行

## 2. 主要技术债

### 2.1 业务逻辑泄露 (High)
回调函数不仅仅是“通知”更新，还包含了大量的实际业务逻辑。例如 `update_dougong` 负责初始化斗栱数据、更新楼阁层高、触发重建。这些逻辑应该属于业务逻辑层（Service Layer）。

**建议**: 回调函数应该只充当控制器（Controller），负责解析参数并调用业务逻辑层（如 `build` 模块）的方法，而不应该包含具体的计算逻辑。

### 2.2 隐式依赖与循环导入 (Medium)
- 为了避免循环导入，大量使用了函数内部导入 (`from . import build`, `from . import template`)。这是一种反模式，说明模块划分存在问题。

**建议**: 通过重构模块依赖关系，或者使用信号/槽机制（发布订阅模式）来解耦数据更新与业务执行。

### 2.3 混合了 UI 更新 (Low)
- 回调中包含了 `utils.hideLayer` 等 UI 显隐操作。虽然这是响应用户操作的一部分，但混合在数据回调中使得逻辑不纯粹。

## 3. 重构计划建议
1. **逻辑下沉**: 将 `update_xxx` 函数中的核心逻辑提取到对应的 `buildXXX.py` 或新的 `service` 模块中。
2. **优化导入**: 解决模块间的循环依赖。
