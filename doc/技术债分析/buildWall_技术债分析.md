# buildWall.py 技术债分析

## 1. 文件概览
- **功能**: 负责装修布局树状结构的营造，主要是墙体（Wall）和装修容器（WallProxy）的管理。
- **代码行数**: 约 715 行。
- **依赖**: `utils`, `buildDoor`, `buildFloor`, `const`, `data`, `texture`。

## 2. 主要技术债

### 2.1 循环依赖风险
- **问题**: `buildWall.py` 导入了 `buildDoor`，而 `buildDoor` 内部也可能依赖墙体相关的数据或逻辑（需检查 `buildDoor` 是否反向依赖）。虽然目前通过函数调用解耦，但逻辑上存在相互依赖。
- **影响**: 模块关系不清晰，容易导致导入错误。
- **建议**: 明确层级关系，`buildWall` 应该作为容器层，`buildDoor` 作为组件层，避免反向依赖。

### 2.2 `wallID` 字符串解析泛滥
- **问题**: 代码中大量出现解析 `wallID`（如 `"wall#3/0#3/3"`）的逻辑，使用 `split('#')` 和 `split('/')`。
- **影响**: 字符串操作脆弱且低效，一旦 ID 格式变更，所有解析代码都会失效。
- **建议**: 引入 `WallID` 或 `LocationID` 值对象（Value Object），封装解析和序列化逻辑。

### 2.3 巨大的 `if-elif` 链
- **问题**: `__tempWallproxy` 和 `__buildWall` 中存在针对不同墙体类型（`ACA_WALLTYPE_*`）的长串 `if-elif` 判断。
- **影响**: 违反开闭原则（OCP），新增墙体类型需要修改多处代码。
- **建议**: 使用多态或注册表模式（Registry Pattern），将不同类型的墙体构建逻辑分发到各自的处理函数或类中。

### 2.4 几何计算分散
- **问题**: 墙体的方向判断（向量叉乘）和坐标计算直接写在业务逻辑中。
- **影响**: 几何逻辑难以复用。
- **建议**: 提取几何计算工具函数。

## 3. 重构优先级
- **高**: 封装 `wallID` 解析逻辑。
- **中**: 重构 `if-elif` 链为分发机制。
- **低**: 提取几何计算函数。
